@page "/"

@using System.Linq
@using Newtonsoft.Json
@using Newtonsoft.Json.Linq
@using System.Xml
@using System.Xml.Linq
@using Panels_And_Forms.Services

<MudContainer MaxWidth="MaxWidth.Large" Class="mud-theme-secondary">
    @foreach(string state in statesFromXml)
    {
        <MudButton
            Variant="Variant.Filled"
            Color="Color.Primary"
            OnClick="() => StateClick(state)"
        >
            @state
        </MudButton>
    }
    <hr />
    @foreach (PanelItem item in panelItems)
    {
        <MudExpansionPanel Text="@item.Text" IsExpanded="@item.IsExpanded">
            @item.Content
        </MudExpansionPanel>
    }
</MudContainer>

@xmlString
<hr />
@jsonString

@code {
    private string jsonString { get; set; } = "";
    private string xmlString { get; set; } = XmlConfig.Data();
    public class PanelItem
    {
        public string Text { get; set; } = "";
        public bool IsExpanded { get; set; } = false;
        public string Content { get; set; } = "";
        public bool ShowPreview { get; set; } = false;
        public bool ShowForms { get; set; } = false;
    }

    private List<string> statesFromXml { get; set; } = new();

    protected override void OnInitialized()
    {
        // Load XML string into XDocument
        XDocument xmlDoc = XDocument.Parse(xmlString);

        // Convert XML to JSON
        jsonString = JsonConvert.SerializeXNode(xmlDoc);

        JObject jsonObject = JObject.Parse(jsonString);

        JObject rootObject = (JObject)jsonObject["root"];

        statesFromXml = new();
        panelItems = new();

        foreach (var state in rootObject)
        {
            statesFromXml.Add(state.Key);
            panelItems.Add(
                new PanelItem { Text = state.Key, Content = $"{state.Key} Content", }
            );
        }
    }


    private List<PanelItem> panelItems { get; set; } = new();

    private void StateClick(string state)
    {
        foreach(PanelItem item in panelItems)
        {
            if(item.Text != state)
            {
                item.IsExpanded = false;
            }
            else
            {
                item.IsExpanded = !item.IsExpanded;
            }
        }
    }
}
